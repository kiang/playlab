<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="bootstrap.min.css" rel="stylesheet">
        <title>Chat</title>
        <script src="socket.io.js"></script>
        <script src='jquery.min.js'></script>
        <style>
            .content {
                height: 280px;
                border: 1px solid;
                overflow: auto;
                float:    left;
            }
            .content >div{
                border-bottom: 1px solid;
            }
            .content >div >label {
                color:  green;
            }
            .content >div >span {
                color: blue;
                display: inline-block;
                width:  50px;
            }

        </style>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div id='content' class="col-md-6 content"></div>
                <div class="col-md-6 content">
                    <form>
                        <input type='text' value='' /><input type='submit' value='send' />
                    </form>
                </div>
            </div>
            <div class="row">
                <div id='counter' class="col-md-12"></div>
            </div>
        </div>

        <script>
            function messageScroll() {
                $('#content').animate({
                    scrollTop: $('#content').get(0).scrollHeight
                }, 300);
            }
            $(function() {
                var myname = null;
                var socket = io.connect('http://127.0.0.1:8080/');
                socket.on('update', function(data) {
                    if (data.msg == '/clear') {
                        $('#content').empty();
                        return;
                    }
                    if (data.user) {
                        $('#content').append('<div><span>' + data.user + ':</span>' + data.msg + '</div>');
                    }
                    else {
                        $('#content').append('<div><label>' + data.msg + '</label></div>');
                    }
                    if (data.counter) {
                        for (ip in data.counter) {
                            var divId = 'ip' + ip;
                            divId = divId.replace(/\./g, '-');
                            if ($('#' + divId).length === 0) {
                                $('#counter').append('<div id="' + divId + '">' + ip + ' : ' + data.counter[ip] + '</div>');
                            } else {
                                $('#' + divId).html(ip + ' : ' + data.counter[ip]);
                            }
                        }
                    }
                    messageScroll();
                });
                $('form').submit(function() {
                    if (myname == null) {
                        myname = prompt("yourname");
                        socket.emit('addme', myname);
                    }
                    socket.emit('msg', {
                        msg: $('input[type=text]').val(),
                        user: myname
                    });
                    $('input[type=text]').val('');
                    messageScroll();
                    return false;
                });
            });
        </script>
    </body>
</html>